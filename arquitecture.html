<!DOCTYPE html>
<html>
    <head>
        <title>Architecture</title>
        <!--Bootstrap-->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <!--Icons-->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
        <!--CSS-->
        <link rel="stylesheet" type="text/css" href="CSS/catalogueStyle.css">
        <link rel="stylesheet" type="text/css" href="CSS/homeStyle.css">
        <link rel="stylesheet" type="text/css" href="CSS/navBarStyle.css">
        <!--Fonts-->
        <link href="https://fonts.googleapis.com/css?family=Raleway:700" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Montserrat:600" rel="stylesheet">
        <!--NavBar-->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta charset="UTF-8">
    </head>
    <body>
        <!--Nav Bar-->
        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container-fluid">
                <div id="navbar" class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <div id="mySidenav" class="sidenav">
                            <button class="closeButton" onclick="closeNav()"><i class="fas fa-arrow-left"></i></button>
                            <a href="invoice_ninja.html"><h2>Invoice Ninja</h2></a>
                            <hr id="navBarLine">
                            <a href="summary.html">Summary</a>
                            <a href="generalDescription.html">General Description</a>
                            <a href="features.html">Features</a>
                            <a href="UI.html">UI</a>
                            <a href="UX.html">UX</a>
                            <a href="performance.html">Performance</a>
                            <a href="bugsandEC.html">Bugs &amp; EC</a>
                            <a href="freealternatives.html">Free alternatives</a>
                            <a href="paidalternatives.html">Paid alternatives</a>
                            <a href="arquitecture.html">Architecture</a>
                        </div>
                        <span id="optionsButton" class="pull-left" onclick="openNav()"><i class="fas fa-bars"></i></span>
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        <a id="logo" href="home.html" class="pull-right"><img src="https://avatars1.githubusercontent.com/u/15712270?s=200&v=4" height="50" width="50" alt="Invoice_ninja logo"></a>
                    </ul>
                </div>
            </div>
        </nav>

        <!--Page Content-->
        <div class="container-fluid">
            <!--Catalogue1----------------------------------->
            <div class="row justify-content-md-center align-items-center catalogueRow">
                <div class="col-sm-6">
                    <h1>Archi- <br> tecture</h1>
                </div>
                <div class="col-sm-6">
                    <div class="w-100 divider"></div>
                    <div class="col">

                        <h2>Storage and data handling</h2>

                        <br>
                        <br>

                        <p>We will now discuss how data is stored in the device and presented to the user. There are 5 points to analyze: </p>
                        <ul id="parragraphContent">
                            <li>SharedPreferences</li>
                            <li>Local-Private</li>
                            <li>External-Public</li>
                            <li>Remote Storage</li>
                            <li>Cache and data fetching strategies</li>
                        </ul>

                        <br>

                        <h3>Shared preferences</h3>

                        <p>There are in total 7 files in which the SharedPreferences library is used</p>
                        <p><strong>main.dart</strong></p>
                        <img src="https://github.com/javierbarbosa42/InvoiceNinjaAnalysis/raw/master/Images/ContentImages/Main.png" height="150" width="700" alt="SharedPreferences in Main file.">

                        <p>In this file, the SharedPreferences library is used for setting up some configurations of the app as setting the dark mode on the app or requiring login</p>

                        <br>

                        <p><strong>auth_middleware.dart</strong></p>
                        <img src="https://github.com/javierbarbosa42/InvoiceNinjaAnalysis/raw/master/Images/ContentImages/SharedPrefsAuth.png" height="300" width="700" alt="SharedPreferences in Main file.">

                        <p>In this file, the SharedPreferences library is used for fetching or saving data on the login.</p>

                        <br>

                        <p><strong>app_middleware.dart</strong></p>
                        <img src="https://github.com/javierbarbosa42/InvoiceNinjaAnalysis/raw/master/Images/ContentImages/SharedPrefsAppMiddle.png" height="300" width="700" alt="SharedPreferences in Main file.">

                        <p>In this file, the SharedPreferences library is used for getting data on the state of the app.</p>

                        <br>

                        <p><strong>expense_edit_vm.dart</strong></p>
                        <img src="https://github.com/javierbarbosa42/InvoiceNinjaAnalysis/raw/master/Images/ContentImages/SharedPrefsExpenseEdit.png" height="300" width="700" alt="SharedPreferences in Main file.">
                        <br>

                        <p>In this file, the SharedPreferences library is used for getting selected preferences on whether to sen an email after registering an expense.</p>

                        <br>

                        <p><strong>payment_edit_vm.dart</strong></p>
                        <img src="https://raw.githubusercontent.com/javierbarbosa42/InvoiceNinjaAnalysis/master/Images/ContentImages/SharedPrefsPayEdit.png
" height="300" width="700" alt="SharedPreferences in Main file.">

                        <p>In this file, the SharedPreferences library is used for getting selected preferences on whether to sen an email after registering a payment.</p>

                        <br>

                        <p><strong>persistence_repository.dart</strong></p>
                        <img src="https://github.com/javierbarbosa42/InvoiceNinjaAnalysis/raw/master/Images/ContentImages/SharedPrefsPersistence.png
" height="300" width="700" alt="SharedPreferences in Main file.">

                        <p>In this file, the SharedPreferences library is used for getting the actual company state.</p>

                        <br>

                        <p><strong>settings_list_vm.dart</strong></p>
                        <br>
                        <img src="https://github.com/javierbarbosa42/InvoiceNinjaAnalysis/raw/master/Images/ContentImages/SharedPrefsSettingsList.png
" height="300" width="700" alt="SharedPreferences in Main file.">

                        <br>

                        <p>In this file, the SharedPreferences library is used for getting the current selected settings.</p>

                        <br>
                        <br>

                        <h3>Local-Private</h3>

                        <p>This refers to storing data in SQLite. This app does not use this storage strategy in implementation but makes use of the <a href="https://pub.dev/packages/cached_network_image">cached_network_image</a> library to create the cache and keep the images in the app.</p>

                        <br>
                        <br>

                        <h3>External-Public</h3>

                        <p>This refers to storing data in an external folder inside the phone, like the sd card. <br>
                        By the way it is implemented (shown below) there is no option for the user to save the picture on the phone, once is selected or confirmed after taking the picture, the app will upload it to the server.</p>
                        <br>
                        <img src="https://github.com/javierbarbosa42/InvoiceNinjaAnalysis/raw/master/Images/ContentImages/CameraUsage.png
" height="300" width="700" alt="Camera Usage">

                        <br>
                        <br>

                        <h3>Remote Storage</h3>

                        <p>Data is fetched and saved remotely using the web API. Recall the app is strongly related to the web app due to it relying on its service to save and get information. This API uses JSON serialized objects to communicate. As follows: </p>
                        <br>

                        <img src="https://github.com/javierbarbosa42/InvoiceNinjaAnalysis/raw/master/Images/ContentImages/API-load.png
" height="300" width="700" alt="API load data">

                        <p>As you can see, the loading process involves forming an url to fetch data from. It also sends the auth status to the remote service so it can check if the request is being made by an authorized client. Saving uses the same principle:</p>
                        <br>

                        <img src="https://github.com/javierbarbosa42/InvoiceNinjaAnalysis/raw/master/Images/ContentImages/API-save.png
" height="400" width="700" alt="API save data">

                        <br>
                        <br>

                        <h3>Cache and data fetching strategies</h3>

                        <p>To avoid needing to fetch multimedia files from the server, cahce is used to queep images locally in the app. With this in mind, they make an implementation of the of the <a href="https://pub.dev/packages/cached_network_image">cached_network_image</a> package in a file called &quot;cached_image.dart&quot; that returns a cached network image or a CircularProgressIndicator if it is not already cached:</p>
                        <br>

                        <img src="https://github.com/javierbarbosa42/InvoiceNinjaAnalysis/raw/master/Images/ContentImages/Cached_image.png
" height="200" width="500" alt="API save data">

                        <br>

                        <p>The fetching strategy used is pull-based. Only when the user asks for cached data is it
downloaded and kept within the app. When the user first tries to load a filter a spinner is shown,
and on airplane mode, a spinner is shown forever.</p>

                        <br>
                        <br>

                        <h2>Patterns</h2>

                        <br>

                        <h3>Architectural patterns</h3>

                        <br>

                        <p>Taken by the CEO's web blog he explains how for Invoice Ninja they implemented a MVC combined with the popular Redux for state managing. The project is organized in this fashion as follows: </p>

<img src="https://github.com/javierbarbosa42/InvoiceNinjaAnalysis/raw/master/Images/ContentImages/ProjectStructure.png
" height="500" width="500" alt="API save data">

                        <p>Where data directory contains the Model, ui directory contains the view and redux directory contains the controller/domain.</p>
                        <br>
                        <p>The MVC pattern implemented with redux looks like this:</p>
                        <br>

                        <img src="https://github.com/javierbarbosa42/InvoiceNinjaAnalysis/raw/master/Images/ContentImages/ArchitectureWithRedux.gif
" height="500" width="600" alt="API save data">
                        <p>(Image from pinterest: <a href="https://co.pinterest.com/pin/477451997990673785/">link</a>)</p>


                        <br>

                        <p>Where the middleware and reducer function as the controller, the store is used as the model and view keeps the same.</p>
                        <br>
                        <p>The API shown in the above figure is actually how the app makes calls to the backend. We actually had to implement the backend by hand in order to have the full features of the mobile app the webapp implemented by us can be found at <a href="http://davidnino.social/login">Invoice Ninja self-hosted</a>. The mentioned backend looks as follows:</p>
                        <br>


                        <img src="https://github.com/javierbarbosa42/InvoiceNinjaAnalysis/raw/master/Images/ContentImages/3tierLevel.png
" height="200" width="600" alt="API save data">

                        <br>

                        <h3>Design patterns</h3>

                        <br>

                        <h3>Strategies</h3>

                        <br>

                        <p>We now are going to take a look at the strategies used by the developers to work more efficiently and optimize performance based on the CEO's blog on flutter.</p>

                        <br>

                        <h4>Creating widgets</h4>

                        <p></p>

                        <p>Kept a DRY code (don’t repeat yourself). Refactoring widgets is just like refactoring standard code, they took patterns of duplicate code and refactored it out to a widget. As a result, widgets can be incredibly small but used throughout the app they both reduce code and make it easier to apply changes later on.</p>

                        <br>

                        <h4>View models</h4>

                        <p>One of the core principles of software architecture is SRP (Single Responsibility Principle). As the views got more complicated a great way they implemented separation of concerns was to create a view model which backs the view.</p>

                        <p>This enabled the view to focus on the layout of the UI while the view models managed the view logic. For example, the view model would handle preparing data from the central store to the format needed by the view and provide methods to dispatch actions to update the store.</p>

                    <h4>Completers</h4>

                    <p>In the app it’s common for the user to trigger an action in the UI which depends on completing a successful request on the server. For example, saving a new record.</p>

                    <p>A common approach in this scenario is to pass the context in the action and have the middleware use the context, however they used completers which provide much cleaner code in the UI layer.</p>

                    <h4>Enums</h4>

                    <p>Invoice Ninja has many modules, for example: clients, products, invoices, tasks, expenses, … They all provide similar functionality (list, view, edit, archive, delete, restore) and then some provide other actions such as invoice or email.</p>

                    <p>To support this they use built_value enums. In this case they have an EntityType enum and an EntityAction enum. A nice aspect of this solution is it’s automatically serialized/deserialized when the state is persisted.</p>

                    <p>The custom widgets then can accept an EntityType parameter which can be used to configure itself from the store. They also added a lookup function in the AppLocalization class to help with translations.</p>

                    <br>

                    <h4>Persistence</h4>

                    <p>Their solution to persistence is to split up the core parts of the store (data, UI and auth) to persist each part separately. As a user makes changes to a new record they constantly persist the UI store without needing to persist the data store which could potentially have tens of thousands or records.</p>

                    <p>If a user starts to create a new record and then quits the app they present the partially completed record when the app is relaunched. This is handled in the code by having any action which requires persistence (such as when data is loaded or modified) implement the PersistData or PersistUI abstract classes. The usage of Persist UI is as follows:</p>

                    <img src="https://github.com/javierbarbosa42/InvoiceNinjaAnalysis/raw/master/Images/ContentImages/PersistUI.png
" height="200" width="400" alt="API save data">
                    <br>

                    <h4>Abstract clases</h4>

                    <p>We have two types of data in the app: editable entities which the user can create and edit (such as clients and invoices) and static data which can be referenced but not changed (such as the list of languages or currencies).</p>

                    <p>To support typical interactions in the app (ie, selecting a choice from a list) a SelectableEntity abstract class was created. The built_value classes then implement the class. This provide a way for each entity type to define how it should be presented and searched in a list, the subtitle of the ListTile is then used to show the matching field. This class is implemented by both types of data.</p>

                    <p>The editable entities implement the BaseEntity class which provides shared functionality such as archiving and deleting and handles filtering the list by their state (active, archived or deleted) and status (ie, draft, sent, paid, …).</p>
                    <br>

                    <h2>Libraries used</h2>

                    <br>

                    <table>
                        <tr>
                            <th>Library name</th>
                            <th>Version</th>
                        </tr>
                        <tr>
                            <td>flutter_redux</td>
                            <td>^0.5.2</td>
                        </tr>
                        <tr>
                            <td>redux_logging</td>
                            <td>^0.3.0</td>
                        </tr>
                        <tr>
                            <td>http</td>
                            <td>^0.11.3+17</td>
                        </tr>
                        <tr>
                            <td>in_app_purchase</td>
                            <td>^0.2.1</td>
                        </tr>
                        <tr>
                            <td>path_provider</td>
                            <td>^0.5.0</td>
                        </tr>
                        <tr>
                            <td>shared_preferences</td>
                            <td>^0.4.2</td>
                        </tr>
                        <tr>
                            <td>font_awesome_flutter</td>
                            <td>^8.0.1</td>
                        </tr>
                        <tr>
                            <td>built_value</td>
                            <td>^6.1.2</td>
                        </tr>
                        <tr>
                            <td>built_collection</td>
                            <td>^4.0.0</td>
                        </tr>
                        <tr>
                            <td>memoize</td>
                            <td>^2.0.0</td>
                        </tr>
                        <tr>
                            <td>url_launcher</td>
                            <td>^3.0.3</td>
                        </tr>
                        <tr>
                            <td>cached_network_image</td>
                            <td>^0.8.0</td>
                        </tr>
                        <tr>
                            <td>share</td>
                            <td>^0.5.3</td>
                        </tr>
                        <tr>
                            <td>intl</td>
                            <td>^0.15.7</td>
                        </tr>
                        <tr>
                            <td>flutter_slidable</td>
                            <td>^0.4.6</td>
                        </tr>
                        <tr>
                            <td>charts_flutter</td>
                            <td>^0.6.0</td>
                        </tr>
                        <tr>
                            <td>google_sign_in</td>
                            <td>^4.0.4</td>
                        </tr>
                        <tr>
                            <td>firebase_auth</td>
                            <td>^0.11.1+11</td>
                        </tr>
                        <tr>
                            <td>local_auth</td>
                            <td>^0.3.0</td>
                        </tr>
                        <tr>
                            <td>sentry</td>
                            <td>^2.2.0</td>
                        </tr>
                        <tr>
                            <td>image_picker</td>
                            <td>^0.6.0+17</td>
                        </tr>
                        <tr>
                            <td>flutter_pdfview</td>
                            <td>^1.0.0+8</td>
                        </tr>
                    </table>


                    </div>
                </div>
            </div>
        </div>


        <!--Screen8----------------------------------------------->
        <div class="row justify-content-md-center align-items-center">
            <div class="col contactPage blackPage">
                <h2 id="infoTitle">Invoice Ninja</h2>
            </div>
        </div>
        <!--JQuery and JavaScript-->
        <script
                src="https://code.jquery.com/jquery-3.3.1.js"
                integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
                crossorigin="anonymous"></script>
        <!--NavBar JS-->
        <script type="text/javascript" src="JS/navBar.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    </body>
</html>